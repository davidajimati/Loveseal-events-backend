generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum maritalStatus {
  SINGLE
  MARRIED
  SEPARATED
  DIVORCED
  WIDOWED
}

enum employmentStatus {
  UNEMPLOYED
  EMPLOYED
  SELF_EMPLOYED
}

enum gender {
  MALE
  FEMALE
}

enum eventStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum particpationMode {
  CAMPER
  ATTENDEE
  ONLINE
}

enum accommodationType {
  HOSTEL
  HOTEL
  NONE
}

enum regStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum paymentStatus {
  PENDING
  SUCCESSFUL
  FAILED
}

enum adminUserRoles {
  SUPERADMIN
  ADMIN
  SPECTATOR
  EVENT_MANAGER
  FINANCE_ADMIN
  ACCOMMODATION_ADMIN
}

enum regInitiator {
  USER
  ADMIN
}

enum roomAllocator {
  ADMIN
  ALGORITHM
}

enum roomAllocationStatus {
  ACTIVE
  REVOKED
}

model userInformation {
  userId             String                   @id @default(uuid(4))
  email              String                   @unique
  firstName          String
  lastName           String
  emailVerified      Boolean?
  phoneNumber        String
  gender             gender
  ageRange           String?
  localAssembly      String?
  maritalStatus      maritalStatus?
  employmentStatus   employmentStatus?        @default(EMPLOYED)
  createdAt          DateTime?                @default(now())
  updatedAt          DateTime?
  stateOfResidence   String?
  eventRegistrations eventRegistrationTable[]
  paymentRecords     paymentRecords[]

  @@index(fields: [userId, email], map: "userInfoIndex")
  @@map("loveseal_events_user_info_table")
}

model otpLogTable {
  id            String    @id @default(uuid(4))
  email         String
  otp           String
  otpReference  String
  otpReason     String
  otpUsed       Boolean?  @default(false)
  timeGenerated DateTime  @default(now())
  timeUsed      DateTime?
  created       DateTime  @default(now())

  @@map("otp_log_table")
}

model adminUserRecords {
  adminUserId             String                    @id @default(uuid(4))
  tenantId                String                    @default(uuid(7))
  firstName               String
  lastName                String
  email                   String                    @unique
  role                    adminUserRoles
  userName                String
  eventsOwned             eventInformation[]
  dateCreated             DateTime
  updatedAt               DateTime?
  eventsAdminRolesTracker eventsAdminRolesTracker[]

  @@unique([tenantId, adminUserId])
  @@map("admin_users_table")
}

model eventsAdminRolesTracker {
  id              String           @id @default(uuid(4))
  eventId         String
  adminUserId     String
  eventRole       adminUserRoles
  eventRecord     eventInformation @relation(fields: [eventId], references: [eventId])
  adminUserRecord adminUserRecords @relation(fields: [adminUserId], references: [adminUserId])

  @@map("events_admin_role_table")
}

model eventInformation {
  eventId                 String                    @id @default(uuid(4))
  tenantId                String
  eventOwnerId            String
  eventRecord             adminUserRecords          @relation(fields: [tenantId, eventOwnerId], references: [tenantId, adminUserId])
  eventYear               String
  eventName               String
  startDate               DateTime
  endDate                 DateTime
  eventStatus             eventStatus
  accommodationNeeded     Boolean
  registrationOpenAt      DateTime
  registrationCloseAt     DateTime
  registrants             eventRegistrationTable[]
  createdAt               DateTime?                 @default(now())
  updatedAt               DateTime?
  eventsAdminRolesTracker eventsAdminRolesTracker[]
  paymentRecords          paymentRecords[]
  accommodationFacilities accommodationFacilities[]

  @@index(fields: [eventId, tenantId, eventOwnerId], map: "eventInfoIndex")
  @@map("loveseal_events_table")
}

model eventRegistrationTable {
  regId                 String             @id @default(uuid(4))
  eventId               String
  userId                String
  userRecord            userInformation    @relation(fields: [userId], references: [userId])
  eventRecord           eventInformation   @relation(fields: [eventId], references: [eventId])
  status                regStatus?         @default(PENDING)
  registrationCompleted Boolean?
  participationMode     particpationMode
  intiator              regInitiator       @default(USER)
  accommodationType     accommodationType? @default(NONE)
  accommodationAssigned Boolean
  accommodationDetails  String
  createdAt             DateTime?          @default(now())
  updatedAt             DateTime?

  @@index(fields: [eventId], map: "eventRegIndex")
  @@map("event_registrations_table")
}

model paymentRecords {
  paymentId        String           @id @default(uuid(4))
  userId           String
  eventId          String
  userRecord       userInformation  @relation(fields: [userId], references: [userId])
  eventRecord      eventInformation @relation(fields: [eventId], references: [eventId])
  paymentReason    String
  amount           Float
  currencyCode     String?          @default("NGN")
  paymentReference String
  paymentStatus    paymentStatus    @default(PENDING)
  paidAt           DateTime         @default(now())
  createdAt        DateTime?        @default(now())
  updatedAt        DateTime?

  @@index(fields: [eventId], map: "paymentRecordsIndex")
  @@map("event_payment_records")
}

model accommodationFacilities {
  facilityId              String                @id @default(uuid(4))
  eventId                 String
  accommodationCategoryId String
  facilityName            String
  available               Boolean
  selfEmployedUserPrice   Float?
  employedUserPrice       Float?
  unemployedUserPrice     Float?
  totalCapacity           Int
  capacityOccupied        Int                   @default(0)
  eventRecord             eventInformation      @relation(fields: [eventId], references: [eventId])
  hostelAccommodation     hostelAccommodation[]
  hotelAccommodation      hotelAccommodation[]
  categoryRecord          accommodationCategory @relation(fields: [accommodationCategoryId], references: [accommodationCategoryId])

  @@map("accomodation_facilities")
}

model hostelAccommodation {
  roomId            String                  @id @default(uuid(4))
  facilityId        String
  roomCode          String                  @default(uuid(4))
  roomIdentifier    String
  capacity          Int
  capacityOccupied  Int                     @default(0)                    
  genderRestriction gender
  adminReserved     Boolean
  facilityRecord    accommodationFacilities @relation(fields: [facilityId], references: [facilityId])

  @@map("hostel_accommodation_table")
}

model hostelAllocations {
  id               String               @id @default(uuid(4))
  roomId           String
  registrationId   String
  eventId          String
  allocator        roomAllocator
  allocatedAt      DateTime
  allocationStatus roomAllocationStatus

  @@map("hostel_allocations_table")
}

model hotelAccommodation {
  hotelId            String                  @id @default(uuid(4))
  facilityId         String
  hotelCode          String                  @default(uuid(4))
  hotelIdentifier    String
  address            String
  description        String
  available          Boolean?
  price              Float?
  noOfRoomsAvailable Int
  noOfRoomsOccupied  Int                     @default(0)
  genderRestriction  gender
  adminReserved      Boolean
  facilityRecord     accommodationFacilities @relation(fields: [facilityId], references: [facilityId])

  @@map("hotel_accommodation_table")
}

model accommodationCategory {
  accommodationCategoryId String                    @id @default(uuid(4))
  name                    String
  facilityRecord          accommodationFacilities[]

  @@map("accommodation_categories")
}
