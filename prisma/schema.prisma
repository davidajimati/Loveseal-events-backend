generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "mysql"
  url      = env("DATABASE_URL")
}

model userInformation {
  userId             String                   @id @default(uuid())
  email              String                   @unique
  firstName          String?
  lastName           String?
  emailVerified      Boolean?
  phoneNumber        String?
  gender             gender?
  ageRange           String?
  localAssembly      String?
  maritalStatus      maritalStatus?
  employmentStatus   employmentStatus?        @default(EMPLOYED)
  createdAt          DateTime?                @default(now())
  updatedAt          DateTime?
  stateOfResidence   String?
  country            String?
  minister           Boolean?                 @default(false)
  residentialAddress String?
  paymentRecords     paymentRecords[]
  eventRegistrations eventRegistrationTable[]

  @@index([userId, email], map: "userInfoIndex")
  @@map("loveseal_events_user_info_table")
}

model otpLogTable {
  id            String    @id @default(uuid())
  email         String
  otp           String
  otpReference  String
  otpReason     String
  otpUsed       Boolean?  @default(false)
  timeGenerated DateTime  @default(now())
  timeUsed      DateTime?
  created       DateTime  @default(now())

  @@map("otp_log_table")
}

model adminUserRecords {
  adminUserId             String                    @id @default(uuid())
  tenantId                String?                   @default(uuid())
  firstName               String
  lastName                String
  email                   String                    @unique
  role                    adminUserRoles?
  userName                String?
  dateCreated             DateTime?                 @default(now())
  updatedAt               DateTime?                 @default(now())
  eventsAdminRolesTracker eventsAdminRolesTracker[]
  eventsOwned             eventInformation[]

  @@unique([tenantId, adminUserId])
  @@map("admin_users_table")
}

model eventsAdminRolesTracker {
  id              String           @id @default(uuid())
  eventId         String
  adminUserId     String
  eventRole       adminUserRoles
  adminUserRecord adminUserRecords @relation(fields: [adminUserId], references: [adminUserId])
  eventRecord     eventInformation @relation(fields: [eventId], references: [eventId])

  @@index([adminUserId], map: "idx_events_admin_role_adminUserId")
  @@index([eventId], map: "idx_events_admin_role_eventId")
  @@map("events_admin_role_table")
}

model eventInformation {
  eventId                 String                    @id @default(uuid())
  tenantId                String
  eventOwnerId            String
  eventYear               String
  eventName               String
  startDate               DateTime
  endDate                 DateTime
  venue                   String?
  eventStatus             eventStatus
  accommodationNeeded     Boolean
  registrationOpenAt      DateTime
  registrationCloseAt     DateTime
  createdAt               DateTime?                 @default(now())
  updatedAt               DateTime?
  accommodationFacilities accommodationFacilities[]
  paymentRecords          paymentRecords[]
  registrants             eventRegistrationTable[]
  eventsAdminRolesTracker eventsAdminRolesTracker[]
  adminRecord             adminUserRecords          @relation(fields: [tenantId, eventOwnerId], references: [tenantId, adminUserId])
  dependantInfo           dependantInfoTable[]
  accomodationCategories    accommodationCategory[]

  @@index([eventId, tenantId, eventOwnerId], map: "eventInfoIndex")
  @@index([tenantId, eventOwnerId], map: "idx_loveseal_events_table_tenantId_eventOwnerId_fkey")
  @@map("loveseal_events_table")
}

model eventRegistrationTable {
  regId                 String               @id @default(uuid())
  eventId               String
  userId                String
  status                regStatus?           @default(PENDING)
  registrationCompleted Boolean?
  participationMode     particpationMode
  initiator             regInitiator         @default(USER)
  accommodationType     accommodationType?   @default(NONE)
  accommodationAssigned Boolean
  accommodationDetails  String
  createdAt             DateTime?            @default(now())
  updatedAt             DateTime?
  eventRecord           eventInformation     @relation(fields: [eventId], references: [eventId])
  userRecord            userInformation      @relation(fields: [userId], references: [userId])
  dependantInfo         dependantInfoTable[]

  @@unique([eventId, userId], map: "eventRegEventUserUnique")
  @@index([eventId], map: "eventRegIndex")
  @@index([userId], map: "idx_event_registrations_table_userId_fkey")
  @@map("event_registrations_table")
}

model dependantInfoTable {
  id            String                 @id @default(uuid())
  parentRegId   String
  eventId       String
  name          String
  age           Int
  gender        gender
  paymentStatus paymentStatus?         @default(PENDING)
  amount        BigInt?                @default(5000)
  dateCreated   DateTime?              @default(now())
  updatedAt     DateTime?
  eventInfo     eventInformation       @relation(fields: [eventId], references: [eventId])
  parentRegInfo eventRegistrationTable @relation(fields: [parentRegId], references: [regId])

  @@index([eventId], map: "idx_registrant_dependants_table_eventId_fkey")
  @@index([parentRegId], map: "idx_registrant_dependants_table_parentRegId_fkey")
  @@map("registrant_dependants_table")
}

model paymentRecords {
  paymentId           String           @id @default(uuid())
  userId              String
  eventId             String
  paymentReason       String
  amount              Float
  currencyCode        String?          @default("NGN")
  paymentReference    String           @unique
  providerRawResponse Json?
  paymentStatus       paymentStatus    @default(PENDING)
  paidAt              DateTime         @default(now())
  createdAt           DateTime?        @default(now())
  updatedAt           DateTime?
  eventRecord         eventInformation @relation(fields: [eventId], references: [eventId])
  userRecord          userInformation  @relation(fields: [userId], references: [userId])

  @@index([eventId], map: "paymentRecordsIndex")
  @@index([userId], map: "idx_event_payment_records_userId_fkey")
  @@map("event_payment_records")
}

model accommodationFacilities {
  facilityId              String                @id @default(uuid())
  eventId                 String
  facilityName            String
  available               Boolean
  accommodationCategoryId String
  capacityOccupied        Int                   @default(0)
  employedUserPrice       Float?
  selfEmployedUserPrice   Float?
  totalCapacity           Int
  unemployedUserPrice     Float?
  categoryRecord          accommodationCategory @relation(fields: [accommodationCategoryId], references: [accommodationCategoryId])
  eventRecord             eventInformation      @relation(fields: [eventId], references: [eventId])
  hostelAccommodation     hostelAccommodation[]
  hotelAccommodation      hotelAccommodation[]

  @@index([accommodationCategoryId], map: "idx_accomodation_facilities_accommodationCategoryId_fkey")
  @@index([eventId], map: "idx_accomodation_facilities_eventId_fkey")
  @@map("accomodation_facilities")
}

model hostelAccommodation {
  roomId            String                  @id @default(uuid())
  facilityId        String
  roomCode          String                  @default(uuid())
  roomIdentifier    String
  capacity          Int
  genderRestriction gender
  adminReserved     Boolean
  capacityOccupied  Int                     @default(0)
  facilityRecord    accommodationFacilities @relation(fields: [facilityId], references: [facilityId])

  @@index([facilityId], map: "idx_hostel_accommodation_table_facilityId_fkey")
  @@map("hostel_accommodation_table")
}

model hostelAllocations {
  id               String               @id @default(uuid())
  roomId           String
  registrationId   String
  eventId          String
  paymentReference String               @unique
  allocator        roomAllocator
  allocatedAt      DateTime
  allocationStatus roomAllocationStatus

  @@index([paymentReference], map: "idx_paymentReferenceIndex")
  @@map("hostel_allocations_table")
}

model hotelAllocations {
  id               String               @id @default(uuid())
  hotelRoomId      String
  registrationId   String
  eventId          String
  paymentReference String               @unique
  allocator        roomAllocator
  allocatedAt      DateTime
  allocationStatus roomAllocationStatus
  hotelRoomRecord  hotelAccommodation   @relation(fields: [hotelRoomId], references: [roomTypeId])

  @@index([paymentReference], map: "idx_hotel_allocaton_paymentReferenceIndex")
  @@index([hotelRoomId], map: "idx_hotel_allocations_table_hotelRoomId_fkey")
  @@map("hotel_allocations_table")
}

model hotelAccommodation {
  roomTypeId         String                  @id @default(uuid())
  facilityId         String
  roomType           String?
  address            String
  description        String
  available          Boolean?
  genderRestriction  gender
  adminReserved      Boolean
  noOfRoomsAvailable Int
  noOfRoomsOccupied  Int                     @default(0)
  price              Float?
  facilityRecord     accommodationFacilities @relation(fields: [facilityId], references: [facilityId])
  hotelAllocations   hotelAllocations[]

  @@index([facilityId], map: "idx_hotel_accommodation_table_facilityId_fkey")
  @@map("hotel_accommodation_table")
}

model accommodationCategory {
  accommodationCategoryId String                    @id @default(uuid())
  name                    accommodationType
  eventId                 String?
  facilityRecord          accommodationFacilities[]
  eventRecord             eventInformation?   @relation(fields: [eventId], references: [eventId])

  @@map("accommodation_categories")
}

enum maritalStatus {
  SINGLE
  MARRIED
  SEPARATED
  DIVORCED
  WIDOWED
}

enum employmentStatus {
  UNEMPLOYED
  EMPLOYED
  SELF_EMPLOYED
}

enum gender {
  MALE
  FEMALE
}

enum eventStatus {
  DRAFT
  ACTIVE
  CLOSED
}

enum particpationMode {
  CAMPER
  ATTENDEE
  ONLINE
}

enum accommodationType {
  HOSTEL
  HOTEL
  NONE
}

enum regStatus {
  PENDING
  CONFIRMED
  CANCELLED
}

enum paymentStatus {
  PENDING
  SUCCESSFUL
  FAILED
}

enum adminUserRoles {
  SUPERADMIN
  ADMIN
  SPECTATOR
  EVENT_MANAGER
  FINANCE_ADMIN
  ACCOMMODATION_ADMIN
}

enum regInitiator {
  USER
  ADMIN
}

enum roomAllocator {
  ADMIN
  ALGORITHM
}

enum roomAllocationStatus {
  ACTIVE
  PENDING
  REVOKED
}
